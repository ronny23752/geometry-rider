{"id":"48319","variant":"standard"}
<!DOCTYPE html>
<html lang="de">
<head>
<link rel="icon" href="favicon.ico" type="image/x-icon">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Geometry Rider</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:Verdana,sans-serif; cursor: url("cursor.png") 4 4, auto; }
canvas { display:block; margin:0 auto; background:#111; }
#shop {
    display: none; /* versteckt den Shop initial */
    position: fixed;
    top:0; left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    color:#fff;
    text-align:center;
    padding:50px 20px 20px 20px;
    font-family:Verdana;
    z-index:50;
    overflow-y:auto;
    box-sizing: border-box;
}
button, input {
    font-family: Verdana, sans-serif;
}

#shopButton {
    position:absolute; top:10px; right:10px; padding:10px 20px;
    font-size:18px; border-radius:8px; background:#222; color:#fff; border:none; cursor:pointer; z-index:60;
}
.shopItem { margin:12px; font-size:20px; display:flex; align-items:center; justify-content:center; gap:12px; }
.shopItem .name { min-width:180px; text-align:left; }
.shopItem button { padding:6px 12px; font-size:16px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<div id="warningOverlay" style="
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.85);
    color:white;
    font-family:Verdana, sans-serif;
    text-align:center;
    padding-top:150px;
    z-index:1000;
">
    <h1>Score-Reset am 6. Dezember 2025</h1>
    <p>Am <strong>06.12.2025</strong> werden sämtliche Accounts in Geometry Rider zurückgesetzt.<br> Grund dafür war ein Fehler im Speicherungssystem, welcher allen Spielern ermöglichte, unendliche Münzen zu erhalten. Das Problem wurde nun gelöst. Ab morgen können alle Spieler sich mit dem Code <code>JF4-J89</code> 500 Münzen holen. Wir danken für euer Verständnis.</p>
    <button onclick="closeWarning()" style="
        padding:10px 20px; font-size:18px; border-radius:8px; cursor:pointer;
    ">OK</button>
</div>

<div id="shop">
    <h1>Fahrzeug-Shop</h1>
    <div id="coins" style="font-size:20px; margin-bottom:12px;"></div>
    <div id="carList"></div>
    <button onclick="closeShop()" style="margin-top:30px; padding:10px 20px; font-size:20px; border-radius:10px;">Zurück</button>
</div>

<button id="shopButton">Shop öffnen</button>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// --- Konstanten ---
const GRAVITY = 0.6;
const JUMP_FORCE = -12;
const PLAYER_WIDTH = 40;
const PLAYER_HEIGHT = 20;
const OBSTACLE_WIDTH = 40;
const BASELINE = canvas.height-40;

// --- Shop (Daten) ---
const cars = [
{name:"Greenline Classic", rarity:"Standard", price:0, color:"#0f0"},
{name:"Urban Runner", rarity:"Standard", price:150, color:"#3af"},
{name:"Street Breeze", rarity:"Standard", price:220, color:"#ff0"},
{name:"Neon Hopper", rarity:"Standard", price:300, color:"#f0f"},
{name:"Turbo Rookie", rarity:"Standard", price:380, color:"#fa0"},
{name:"Comet Lite", rarity:"Standard", price:450, color:"#fff"},
{name:"Silver Pulse", rarity:"Selten", price:650, color:"#ccc"},
{name:"Aero Swift", rarity:"Selten", price:720, color:"#9cf"},
{name:"Velo Strider", rarity:"Selten", price:800, color:"#bfb"},
{name:"Quartz Rider", rarity:"Selten", price:920, color:"#fc9"},
{name:"Trail Dancer", rarity:"Selten", price:1040, color:"#f99"},
{name:"Chrome Sprint", rarity:"Selten", price:1180, color:"#9ff"},
{name:"Crystal Edge", rarity:"Selten", price:1300, color:"#cdf"},
{name:"Solar Trail S", rarity:"Selten", price:1450, color:"#fd6"},
{name:"Pyroflare V1", rarity:"Episch", price:1700, color:"#f55"},
{name:"Astra Cyclone", rarity:"Episch", price:1950, color:"#5af"},
{name:"Voltrush EX", rarity:"Episch", price:2200, color:"#5ff"},
{name:"Thunder Rift", rarity:"Episch", price:2500, color:"#ccf"},
{name:"Nova Phantom", rarity:"Episch", price:2800, color:"#fff"},
{name:"Plasma Rider", rarity:"Episch", price:3100, color:"#39f"},
{name:"Ignite Spectre", rarity:"Episch", price:3450, color:"#f33"},
{name:"Cryo Phantom", rarity:"Episch", price:3800, color:"#0ff"},
{name:"Lunar Stride", rarity:"Episch", price:4250, color:"#ddd"},
{name:"Eclipse Wraith", rarity:"Mythisch", price:4800, color:"#333"},
{name:"Vortex Ascendant", rarity:"Mythisch", price:5400, color:"#8df"},
{name:"Starforge MK-II", rarity:"Mythisch", price:6100, color:"#dd0"},
{name:"Nebula Phantom", rarity:"Mythisch", price:6800, color:"#a0f"},
{name:"Pyrocore Zenith", rarity:"Mythisch", price:7600, color:"#f00"},
{name:"Solarstorm X", rarity:"Mythisch", price:8500, color:"#ff5"},
{name:"Ion Tempest", rarity:"Mythisch", price:9400, color:"#9ff"},
{name:"Radiant Howler", rarity:"Mythisch", price:10300, color:"#fff"},
{name:"Obsidian Monarch", rarity:"Legendär", price:11800, color:"#111"},
{name:"Quantum Sovereign", rarity:"Legendär", price:13400, color:"#acf"},
{name:"Titanfall Ascendant", rarity:"Legendär", price:15100, color:"#ff9"},
{name:"Aurelion Vanguard", rarity:"Legendär", price:16900, color:"#ffd700"},
{name:"Eternal Starborn", rarity:"Legendär", price:18800, color:"#fff"},
{name:"Okto-Wave", rarity:"Oktopus", price:20500, color:"#6af"},
{name:"Inkjet Surge", rarity:"Oktopus", price:23800, color:"#48c"},
{name:"Kraken Drift", rarity:"Oktopus", price:25500, color:"#24a"},
{name:"Okto-Prime", rarity:"Oktopus", price:31000, color:"#04f"}
];

// sichere Initialisierung von ownedCars (immer Array mit Zahlen)
let ownedCarsRaw = localStorage.getItem("ownedCars");
let ownedCars;
try{
    ownedCars = ownedCarsRaw ? JSON.parse(ownedCarsRaw) : [0];
    if(!Array.isArray(ownedCars)) ownedCars = [0];
    ownedCars = ownedCars.map(n => parseInt(n)).filter(n => !isNaN(n));
    if(ownedCars.length === 0) ownedCars = [0];
}catch(e){
    ownedCars = [0];
    localStorage.setItem("ownedCars", JSON.stringify(ownedCars));
}

// sichere Initialisierung selectedCar
let selRaw = localStorage.getItem("selectedCar");
let selectedCar = parseInt(selRaw);
if(isNaN(selectedCar) || selectedCar < 0 || selectedCar >= cars.length) selectedCar = 0;

// highscore als Zahl
let highscore = parseInt(localStorage.getItem("riderHighscore"));
if(isNaN(highscore)) highscore = 0;

// --- Spielzustände ---
let state = "start"; // "start", "play", "gameover", "shop"
let score = 0;

// --- Spieler ---
let player = {x:50, y:BASELINE-PLAYER_HEIGHT, vy:0, onGround:false, angle:0};
let isHolding = false;

// --- Hindernisse ---
let obstacles = [];
let speed = 5;

// --- Hintergrund ---
let bgStars = [];
for(let i=0;i<100;i++) bgStars.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, size:Math.random()*2+1, speed:0.2+Math.random()*0.3});
// --- Coins ---
let coins = parseInt(localStorage.getItem("coins") || "0");
let coinObjects = [];


// --- Funktionen ---
// Promo-Code Liste
const promoCodes = {
    "JF4-J89": { coins: 500 },
    "L85-436": { carId: 12}
};
let redeemedCodes = JSON.parse(localStorage.getItem("redeemedCodes") || "[]");

// Code einlösen
function redeemCode(input) {
    const code = input.toUpperCase();
    const reward = promoCodes[code];

    if (!reward) {
        alert("Ungültiger Code!");
        return;
    }

    // --- NEU: Prüfen, ob Code schon eingelöst wurde ---
    if (redeemedCodes.includes(code)) {
        alert("Dieser Code wurde bereits verwendet!");
        return;
    }

    let msg = "Code eingelöst!";

    if (reward.coins) {
        coins += reward.coins;
        localStorage.setItem("coins", coins);
        msg += ` Du hast ${reward.coins} Coins erhalten.`;
    }

    if (reward.carId != null && !ownedCars.includes(reward.carId)) {
        ownedCars.push(reward.carId);
        localStorage.setItem("ownedCars", JSON.stringify(ownedCars));
        msg += ` Du hast das Fahrzeug ${cars[reward.carId].name} freigeschaltet!`;
    }

    // --- NEU: Code als benutzt speichern ---
    redeemedCodes.push(code);
    localStorage.setItem("redeemedCodes", JSON.stringify(redeemedCodes));

    alert(msg);
}


function spawnObstacle(){
    let r = Math.random();
    if(r<0.4){
        let height = Math.random()*60+20;
        obstacles.push({x:canvas.width, y:BASELINE-height, width:OBSTACLE_WIDTH, height:height, type:"block"});
    } else if(r<0.7){
        let width = 80, height=20;
        let y = BASELINE-(Math.random()*120+20);
        obstacles.push({x:canvas.width, y:y, width:width, height:height, type:"ramp"});
    } else if(r<0.85){
        let width = 100 + Math.random()*50;
        let y = BASELINE - (150 + Math.random()*150);
        obstacles.push({x:canvas.width, y:y, width:width, height:10, type:"bluePlatform"});
    } else {
        let width = 40 + Math.random()*30;
        let height = 20 + Math.random()*30;
        let y = 20 + Math.random()*100;
        obstacles.push({x:canvas.width, y:y, width:width, height:height, type:"topBlock"});
    }
}

function resetGame(){
    player.y = BASELINE-PLAYER_HEIGHT; player.vy=0; player.angle=0;
    obstacles = []; score=0; speed=5; isHolding=false;
}

function update(){
    if(state!=="play") return;

    let currentSpeed = speed;
    if(isHolding && player.onGround) currentSpeed += 2;

    player.vy += GRAVITY;
    player.y += player.vy;
    player.onGround = false;
    if (player.y < 0) {
        player.y = 0;
        player.vy = 0;
    }

    for(let obs of obstacles){
        if(obs.type==="block" || obs.type==="topBlock"){
            if(player.x<obs.x+obs.width && player.x+PLAYER_WIDTH>obs.x &&
               player.y<obs.y+obs.height && player.y+PLAYER_HEIGHT>obs.y){
                state="gameover";
            }
        } else if(obs.type==="ramp" || obs.type==="bluePlatform"){
            let rampTopY = obs.type==="ramp"? obs.y - (player.x-obs.x)*(obs.height/obs.width) : obs.y;
            if(player.y+PLAYER_HEIGHT>rampTopY && player.y+PLAYER_HEIGHT<rampTopY+20 &&
               player.x+PLAYER_WIDTH>obs.x && player.x<obs.x+obs.width &&
               player.vy >=0){
                player.y = rampTopY-PLAYER_HEIGHT;
                player.vy = 0;
                player.onGround = true;
            }
        }
    }

    if(player.y+PLAYER_HEIGHT>BASELINE){
        player.y = BASELINE-PLAYER_HEIGHT;
        player.vy = 0;
        player.onGround = true;
    }

    obstacles = obstacles.filter(obs => obs.x+obs.width>0);
    obstacles.forEach(obs => obs.x -= currentSpeed);
    // --- Coins bewegen ---
coinObjects = coinObjects.filter(c => c.x + c.size > 0);
coinObjects.forEach(c => c.x -= currentSpeed);

coinObjects.forEach((c,i)=>{
if (player.x < c.x + c.size &&
player.x + PLAYER_WIDTH > c.x &&
player.y < c.y + c.size &&
player.y + PLAYER_HEIGHT > c.y) {

    // --- Münzwert nach Auto-Seltenheit berechnen ---
    let rarityMultiplier = 1;
    if(cars[selectedCar]){
        switch(cars[selectedCar].rarity){
            case "Standard": rarityMultiplier=1; break;
            case "Selten": rarityMultiplier=1.5; break;
            case "Episch": rarityMultiplier=2; break;
            case "Mythisch": rarityMultiplier=3; break;
            case "Legendär": rarityMultiplier=6; break;
            case "Oktopus": rarityMultiplier=12; break;
            default: rarityMultiplier=1; break;
        }
    }

    coins += Math.floor(1 * rarityMultiplier); // Münzen erhöhen
    localStorage.setItem("coins", coins);
    coinObjects.splice(i,1);
}

});

// neuen Coin spawnen
spawnCoin();


    score += 0.01;
    if(Math.random()<0.03) spawnObstacle();
}

function drawPlayer(){
    // fallback-Farbe, falls selectedCar aus dem Array gefallen ist
    let color = "#0ff";
    if(Number.isInteger(selectedCar) && cars[selectedCar] && cars[selectedCar].color) color = cars[selectedCar].color;

    ctx.save();
    ctx.translate(player.x + PLAYER_WIDTH/2, player.y + PLAYER_HEIGHT/2);
    ctx.rotate(player.angle);

    ctx.fillStyle = color;
    ctx.shadowColor = color;
    ctx.shadowBlur = 10;
    ctx.fillRect(-PLAYER_WIDTH/2 + 5, -PLAYER_HEIGHT/2, 30, 20);
    ctx.shadowBlur = 0;

    ctx.fillStyle = "#444";
    ctx.beginPath(); ctx.arc(-10, 12, 6, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(20, 12, 6, 0, Math.PI*2); ctx.fill();

    ctx.restore();
}

function drawObstacles(){
    obstacles.forEach(obs=>{
        if(obs.type==="block"){
            ctx.fillStyle="#f33"; ctx.fillRect(obs.x,obs.y,obs.width,obs.height);
            ctx.fillStyle="#b00"; ctx.fillRect(obs.x,obs.y,obs.width/4,obs.height);
            ctx.strokeStyle="#800"; ctx.strokeRect(obs.x,obs.y,obs.width,obs.height);
        } else if(obs.type==="ramp"){
            ctx.fillStyle="#ff0"; ctx.beginPath();
            ctx.moveTo(obs.x,obs.y+obs.height);
            ctx.lineTo(obs.x+obs.width,obs.y);
            ctx.lineTo(obs.x+obs.width,obs.y+obs.height);
            ctx.closePath(); ctx.fill();
            ctx.strokeStyle="#cc0"; ctx.stroke();
        } else if(obs.type==="bluePlatform"){
            ctx.fillStyle="#00f";
            ctx.fillRect(obs.x,obs.y,obs.width,obs.height);
            ctx.strokeStyle="#005";
            ctx.strokeRect(obs.x,obs.y,obs.width,obs.height);
        } else if(obs.type==="topBlock"){
            ctx.fillStyle="#f33";
            ctx.fillRect(obs.x,obs.y,obs.width,obs.height);
            ctx.strokeStyle="#800";
            ctx.strokeRect(obs.x,obs.y,obs.width,obs.height);
        }
    });
}
function drawCoins(){
    coinObjects.forEach(c=>{
        ctx.fillStyle = "#ff0";
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.size, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = "#aa0";
        ctx.stroke();
    });
}


function spawnCoin(){
    if(Math.random() < 0.02){ // 2% Chance pro Frame
        coinObjects.push({
            x: canvas.width,
            y: BASELINE - 80 - Math.random()*150,
            size: 15
        });
    }
}


function drawBackground(){
    ctx.fillStyle="#111"; ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle="#555";
    bgStars.forEach(star=>{
        ctx.fillRect(star.x,star.y,star.size,star.size);
        star.x -= star.speed;
        if(star.x<0) star.x=canvas.width;
    });
    ctx.strokeStyle="#0f0"; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(0,BASELINE); ctx.lineTo(canvas.width,BASELINE); ctx.stroke();
}

function draw(){
    drawBackground(); drawObstacles(); drawPlayer();
    ctx.textAlign="left";

    if(state==="start"){
        ctx.fillStyle="#fff"; ctx.font="40px Verdana"; ctx.textAlign="center";
        ctx.fillText("Mini Geometry Rider",canvas.width/2,150);
        ctx.font="20px Verdana"; ctx.fillText("Drücke Space oder tippe, um zu starten",canvas.width/2,200);
        ctx.font="16px Verdana"; ctx.fillText("Klicke oben rechts auf 'Shop öffnen' für Fahrzeuge",canvas.width/2,240);
    } else if(state==="play"){
        ctx.fillStyle="#fff"; ctx.font="20px Verdana"; ctx.shadowColor="#0ff"; ctx.shadowBlur=5;
        ctx.fillText("Score: "+Math.floor(score),10,30);
        ctx.fillText("Highscore: "+Math.floor(highscore),10,60);
        ctx.fillText("Coins: " + coins, 10, 90);

        ctx.shadowBlur=0;
    } else if(state==="gameover"){
        if(score>highscore){ highscore=Math.floor(score); localStorage.setItem("riderHighscore",highscore);}
        ctx.fillStyle="rgba(0,0,0,0.7)"; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.fillStyle="#fff"; ctx.font="40px Arial"; ctx.textAlign="center";
        ctx.fillText("Game Over!",canvas.width/2,canvas.height/2-20);
        ctx.font="20px Verdana";
        ctx.fillText("Score: "+Math.floor(score),canvas.width/2,canvas.height/2+10);
        ctx.fillText("Highscore: "+Math.floor(highscore),canvas.width/2,canvas.height/2+40);
        ctx.fillText("Aktuelle Coins: " + coins, 10, 90);
        ctx.fillText("Tippe oder drücke R zum Neustart",canvas.width/2,canvas.height/2+70);
    }
    // Wenn state === "shop", der DOM-Overlay zeigt den Shop. Wir zeichnen trotzdem Hintergrund/Spiel.
}
function openShop(){
    state = "shop";
    document.getElementById("shop").style.display = "block";
    document.getElementById("coins").innerText = "Coins: " + coins;

    let html = "";
    cars.forEach((c,i)=>{
        let owned = ownedCars.includes(i);
        let btn = "";
        if(owned){
            if(selectedCar === i){
                btn = `<button disabled style="opacity:0.6;">Ausgewählt</button>`;
            } else {
                btn = `<button onclick="selectCar(${i})">Wählen</button>`;
            }
        } else {
            btn = `<button onclick="buyCar(${i})">Kaufen (${c.price})</button>`;
        }

        // Farbe je Seltenheit
        let rarityColor = "#fff";
        switch(c.rarity){
            case "Standard": rarityColor="#0f0"; break;
            case "Selten": rarityColor="#00f"; break;
            case "Episch": rarityColor="#a0f"; break;
            case "Mythisch": rarityColor="#f00"; break;
            case "Legendär": rarityColor="#ff0"; break;
            case "Oktopus": rarityColor="#fa0"; break;
            case "Secret": rarityColor="#fff"; break;
        }

        html += `<div class="shopItem">
                    <span style="color:${c.color}; font-size:20px;">■</span>
                    <div class="name">${c.name}</div>
                    <div style="color:${rarityColor}; font-weight:bold; min-width:80px;">${c.rarity}</div>
                    ${btn}
                 </div>`;
    });

    // --- PROMO-CODE UI ---
    html += `<div style="margin-top:20px;">
                <input type="text" id="codeInput" 
                    placeholder="Code eingeben" 
                    maxlength="7"
                    style="text-transform:uppercase;">
                <button onclick="redeemCode(document.getElementById('codeInput').value)">
                    Einlösen
                </button>
             </div>`;

    document.getElementById("carList").innerHTML = html;

    // --- Auto-Formatter NACH dem Einfügen aktivieren ---
    const codeInput = document.getElementById("codeInput");

    codeInput.addEventListener("input", function(e){
        // nur A–Z und 0–9 erlauben
        let val = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, "");

        // nach 3 Zeichen Hyphen einfügen → XXX-XXX
        if(val.length > 3){
            val = val.slice(0,3) + "-" + val.slice(3,6);
        }

        // auf maximal 7 Zeichen begrenzen
        e.target.value = val.slice(0,7);
    });
}


    function closeShop(){
state = "start"; // oder play, wenn du direkt weiterspielen willst
document.getElementById("shop").style.display = "none";
}

function buyCar(id){
    if (coins < cars[id].price) {
    alert("Zu wenig Coins!");
    return;
}
coins -= cars[id].price;
localStorage.setItem("coins", coins);
    if(!ownedCars.includes(id)) ownedCars.push(id);
    localStorage.setItem("ownedCars", JSON.stringify(ownedCars));
    openShop();
}

function selectCar(id){
    selectedCar = id;
    localStorage.setItem("selectedCar", id);
    openShop();
}
function oneTimeReset() {
    const resetDate = "2025-12-06"; // Datum des einmaligen Resets
    const today = new Date().toISOString().slice(0,10); // "YYYY-MM-DD"
    const resetDone = localStorage.getItem("oneTimeResetDone");

    if(today === resetDate && !resetDone) {
        // --- Zurücksetzen ---
        localStorage.setItem("coins", "0");
        localStorage.setItem("riderHighscore", "0");
        localStorage.setItem("ownedCars", JSON.stringify([0])); // Standard-Auto behalten

        // --- als erledigt markieren ---
        localStorage.setItem("oneTimeResetDone", "true");
        console.log("Einmaliger Reset durchgeführt!");
    }
}

// Direkt beim Laden der Seite aufrufen
oneTimeReset();
function checkWarningOverlay() {
    const params = new URLSearchParams(window.location.search);
    if(params.has("warning1")) {
        document.getElementById("warningOverlay").style.display = "block";
    }
}

function closeWarning() {
    document.getElementById("warningOverlay").style.display = "none";
}

// direkt beim Laden prüfen
checkWarningOverlay();

function gameLoop(){ update(); draw(); requestAnimationFrame(gameLoop); }

// --- Eingaben ---
document.addEventListener("keydown",(e)=>{
    if(e.code==="Space" || e.code==="ArrowUp"){
        if(state==="start"){ state="play"; resetGame(); return; }
        if(state==="play" && !isHolding) player.vy=JUMP_FORCE;
        isHolding=true;
    }
    if(e.code==="KeyR" && state==="gameover"){ state="start"; }
    if(e.code==="KeyS" && state==="start"){ openShop(); } // zusätzliche Shortcut
});
document.addEventListener("keyup",(e)=>{ if(e.code==="Space" || e.code==="ArrowUp") isHolding=false; });

document.addEventListener("touchstart",()=>{
    if(state==="start"){ state="play"; resetGame(); return; }
    if(state==="gameover"){ state="start"; return; }
    if(!isHolding) player.vy=JUMP_FORCE;
    isHolding=true;
});
document.addEventListener("touchend",()=>{ isHolding=false; });

// Shop-Button
document.getElementById("shopButton").addEventListener("click", () => {
    openShop();
});

gameLoop();
</script>
</body>
</html>
