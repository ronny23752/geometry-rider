<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Geometry Rider</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:Arial, sans-serif; cursor: url("cursor.png") 4 4, auto; }
canvas { display:block; margin:0 auto; background:#111; }

#shopOverlay {
    position:absolute; top:50px; left:50%; transform:translateX(-50%);
    width:700px; max-height:400px; background:rgba(0,0,0,0.85);
    border:2px solid #0f0; border-radius:10px; padding:10px;
    overflow-y:auto; display:none; z-index:10;
}
.carItem {
    display:flex; align-items:center; margin:5px 0; padding:5px; border-radius:5px; background:#222;
}
.colorBox { width:50px; height:30px; margin-right:10px; border-radius:5px; border:2px solid #000; }
.carInfo { flex:1; color:#fff; }
.carButton { background:#0f0; border:none; padding:5px 10px; margin-left:10px; cursor:pointer; border-radius:5px; }
.closeBtn { background:#f33; color:#fff; margin-bottom:10px; padding:5px 10px; border:none; border-radius:5px; cursor:pointer; }
.dailyBtn { background:#222; color:#fff; padding:5px 10px; margin:10px 0; border:none; cursor:pointer; width:100%; border-radius:5px; }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<div id="shopOverlay">
    <button class="closeBtn" id="closeShop">Schließen</button>
    <h2 style="color:white; text-align:center;">AutoShop</h2>
    <p id="coinsText" style="text-align:center; color:white;"></p>
    <div id="carsContainer"></div>
    <button class="dailyBtn" id="dailyCoinsBtn">Tägliche Münzen +30</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// ---------------------------
// Konstanten
// ---------------------------
const GRAVITY = 0.6;
const JUMP_FORCE = -12;
const PLAYER_WIDTH = 40;
const PLAYER_HEIGHT = 20;
const OBSTACLE_WIDTH = 40;
const BASELINE = canvas.height-40;
const COIN_RADIUS = 10;
const DAILY_COINS = 30;

// ---------------------------
// Spielvariablen
// ---------------------------
let state = "start"; // start, play, gameover
let score = 0;
let highscore = parseInt(localStorage.getItem("riderHighscore")) || 0;
let coinsOwned = parseInt(localStorage.getItem("coinsOwned")) || 0;

// Spieler
let player = { x:50, y:BASELINE-PLAYER_HEIGHT, vy:0, onGround:false, angle:0 };
let isHolding = false;

// Obstacles & Coins
let obstacles = [];
let coins = [];
let speed = 5;

// Autos / Shop
let cars = [
    {name:"Grün", price:0, color:"#0f0", rarity:"Standard"},
    {name:"Rot", price:50, color:"#f00", rarity:"Selten"},
    {name:"Blau", price:100, color:"#00f", rarity:"Selten"},
    {name:"Gelb", price:200, color:"#ff0", rarity:"Selten"},
    {name:"Lila", price:400, color:"#a0f", rarity:"Episch"},
    {name:"Orange", price:800, color:"#fa0", rarity:"Episch"},
    {name:"Cyan", price:1600, color:"#0ff", rarity:"Episch"},
    {name:"Rosa", price:3200, color:"#f0f", rarity:"Mythisch"},
    {name:"Gold", price:6400, color:"#ff0", rarity:"Mythisch"},
    {name:"Silber", price:12800, color:"#ccc", rarity:"Mythisch"},
    {name:"Diamant", price:25600, color:"#0ff", rarity:"Legendär"},
    {name:"Smaragd", price:51200, color:"#0a0", rarity:"Legendär"},
    {name:"Rubin", price:102400, color:"#f00", rarity:"Legendär"},
    {name:"Topas", price:204800, color:"#fa0", rarity:"Legendär"},
    {name:"Ametyst", price:409600, color:"#a0f", rarity:"Oktopus"},
    {name:"Oktopus", price:819200, color:"#00a", rarity:"Oktopus"},
    {name:"Saphir", price:900, color:"#00a", rarity:"Selten"},
    {name:"Türkis", price:1200, color:"#0ff", rarity:"Selten"},
    {name:"Koralle", price:2000, color:"#f66", rarity:"Episch"},
    {name:"Magenta", price:2500, color:"#f0f", rarity:"Episch"},
    {name:"Bronze", price:3000, color:"#b76", rarity:"Mythisch"},
    {name:"Platin", price:4000, color:"#ccc", rarity:"Mythisch"},
    {name:"Onyx", price:5000, color:"#111", rarity:"Legendär"},
    {name:"Titan", price:6000, color:"#888", rarity:"Legendär"},
    {name:"Kraken", price:7000, color:"#0ff", rarity:"Oktopus"},
    {name:"Leviathan", price:8000, color:"#0a0", rarity:"Oktopus"}
];
let ownedCars = JSON.parse(localStorage.getItem("ownedCars")) || [0];
let selectedCar = parseInt(localStorage.getItem("selectedCar")) || 0;

// Shop Overlay
const shopOverlay = document.getElementById("shopOverlay");
const coinsText = document.getElementById("coinsText");
const carsContainer = document.getElementById("carsContainer");
const closeShopBtn = document.getElementById("closeShop");
const dailyCoinsBtn = document.getElementById("dailyCoinsBtn");

// ---------------------------
// Funktionen
// ---------------------------
function getRarityColor(r){switch(r){case"Standard":return"#0f0";case"Selten":return"#00f";case"Episch":return"#a0f";case"Mythisch":return"#fa0";case"Legendär":return"#ff0";case"Oktopus":return"#0ff";default:return"#fff";}}

// Shop aktualisieren
function refreshShop(){
    coinsText.innerText = `Deine Münzen: ${coinsOwned}`;
    carsContainer.innerHTML = "";
    cars.forEach((car,i)=>{
        let div = document.createElement("div"); div.className="carItem";
        let color = document.createElement("div"); color.className="colorBox"; color.style.background=car.color;
        let info = document.createElement("div"); info.className="carInfo";
        info.innerText = `${car.name} [${car.rarity}] - ${car.price} Münzen` + (ownedCars.includes(i)?" (Besitzt)":"") + (selectedCar===i?" <- Ausgewählt":"");
        let btn = document.createElement("button"); btn.className="carButton";
        if(ownedCars.includes(i)){ btn.innerText = selectedCar===i?"Ausgewählt":"Wählen"; } else { btn.innerText="Kaufen"; }
        btn.onclick = ()=>{
            if(!ownedCars.includes(i)){
                if(coinsOwned>=car.price){ coinsOwned-=car.price; ownedCars.push(i); localStorage.setItem("coinsOwned",coinsOwned); localStorage.setItem("ownedCars",JSON.stringify(ownedCars)); }
                else { alert("Nicht genug Münzen!"); return; }
            }
            selectedCar=i; localStorage.setItem("selectedCar",selectedCar);
            refreshShop();
        };
        div.appendChild(color); div.appendChild(info); div.appendChild(btn);
        carsContainer.appendChild(div);
    });
}

// Tägliche Münzen
dailyCoinsBtn.onclick = ()=>{
    let last = parseInt(localStorage.getItem("lastDailyClaim")) || 0;
    let now = Date.now();
    if(now-last>24*60*60*1000){ coinsOwned+=30; localStorage.setItem("coinsOwned",coinsOwned); localStorage.setItem("lastDailyClaim", now); alert("Du hast 30 Münzen erhalten!"); refreshShop(); }
    else { let remaining=24*60*60*1000-(now-last); let hours=Math.floor(remaining/3600000); let minutes=Math.floor((remaining%3600000)/60000); alert(`Nächste Münzen in ${hours}h ${minutes}m`); }
};
closeShopBtn.onclick = ()=>{ shopOverlay.style.display="none"; };

// ---------------------------
// Obstacles & Coins Spawn
// ---------------------------
function spawnObstacle(){
    let r = Math.random();
    if(r<0.4){ let height=Math.random()*60+20; obstacles.push({x:canvas.width, y:BASELINE-height, width:OBSTACLE_WIDTH, height:height, type:"block"});}
    else if(r<0.7){ let width=80,height=20; let y=BASELINE-(Math.random()*120+20); obstacles.push({x:canvas.width, y:y, width:width, height:height, type:"ramp"});}
    else if(r<0.85){ let width=100+Math.random()*50; let y=BASELINE-(150+Math.random()*150); obstacles.push({x:canvas.width, y:y, width:width, height:10, type:"bluePlatform"});}
    else { let width=40+Math.random()*30; let height=20+Math.random()*30; let y=20+Math.random()*100; obstacles.push({x:canvas.width, y:y, width:width, height:height, type:"topBlock"});}
    if(Math.random()<0.2){ let y=BASELINE-(50+Math.random()*100); coins.push({x:canvas.width, y:y});}
}

// ---------------------------
// Game Reset
// ---------------------------
function resetGame(){ player.y=BASELINE-PLAYER_HEIGHT; player.vy=0; player.angle=0; obstacles=[]; coins=[]; score=0; speed=5; isHolding=false; }

function update(){
    if(state!=="play") return;

    // Schwerkraft anwenden
    player.vy += GRAVITY;
    player.y += player.vy;
    player.onGround = false;

    // Bodenbegrenzung
    if(player.y + PLAYER_HEIGHT > BASELINE){
        player.y = BASELINE - PLAYER_HEIGHT;
        player.vy = 0;
        player.onGround = true;
    }

    // Decke
    if(player.y < 0){
        player.y = 0;
        player.vy = 0;
    }

    // Hindernisse & Rampen prüfen
    for(let obs of obstacles){
        if(obs.type==="block"||obs.type==="topBlock"){
            if(player.x < obs.x + obs.width && player.x + PLAYER_WIDTH > obs.x &&
               player.y < obs.y + obs.height && player.y + PLAYER_HEIGHT > obs.y){
                state="gameover";
            }
        } else if(obs.type==="ramp"||obs.type==="bluePlatform"){
            let rampTopY = obs.type==="ramp"? obs.y-(player.x-obs.x)*(obs.height/obs.width) : obs.y;
            if(player.y+PLAYER_HEIGHT>rampTopY && player.y+PLAYER_HEIGHT<rampTopY+20 &&
               player.x+PLAYER_WIDTH>obs.x && player.x<obs.x+obs.width && player.vy>=0){
                player.y = rampTopY - PLAYER_HEIGHT;
                player.vy = 0;
                player.onGround = true;
            }
        }
    }

    let currentSpeed = speed; 
    if(isHolding && player.onGround) currentSpeed += 2;

    // Coins
    coins = coins.filter(c=>{
        let dx = (player.x+PLAYER_WIDTH/2)-c.x;
        let dy = (player.y+PLAYER_HEIGHT/2)-c.y;
        let dist = Math.sqrt(dx*dx+dy*dy);
        if(dist < COIN_RADIUS+Math.max(PLAYER_WIDTH,PLAYER_HEIGHT)/2){
            score += 1;
            coinsOwned += 1;
            localStorage.setItem("coinsOwned",coinsOwned);
            return false;
        }
        c.x -= currentSpeed; 
        return c.x + COIN_RADIUS > 0;
    });

    obstacles = obstacles.filter(obs=>obs.x+obs.width>0);
    obstacles.forEach(obs=>obs.x-=currentSpeed);

    score += 0.01;
    if(Math.random() < 0.03) spawnObstacle();
}

// Sprung-Input: beliebig viele Sprünge
document.addEventListener("keydown",(e)=>{
    if(e.code==="Space"||e.code==="ArrowUp"){
        if(state==="start"){ state="play"; resetGame(); return; }
        player.vy = JUMP_FORCE;
        isHolding = true;
    }
});
document.addEventListener("keyup",(e)=>{ if(e.code==="Space"||e.code==="ArrowUp") isHolding=false; });

canvas.addEventListener("touchstart",(e)=>{
    if(state==="start"){ state="play"; resetGame(); return; }
    player.vy = JUMP_FORCE;
    isHolding = true;
});
canvas.addEventListener("touchend",()=>{ isHolding=false; });


</script>
</body>
</html>
